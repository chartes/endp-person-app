$(document).ready(function(){const s="/endp-person/endp-person/admin/person/",o="https://api.nakala.fr/";var t=$(".input-select-tag-form-1"),e=$(".input-select-tag-form-2"),a=$("#pref_label").val();function n(e,t,a){$.ajax({url:s+"get_persons_alt_labels/",type:"POST",data:{type_label:t,person_pref_label:a},success:function(t){e.val(t).trigger("change")},error:function(t){console.log(t)}})}function i(t){t.select2({tags:[""],tokenSeparators:[";"],separator:";"}).on("select2-open",function(){$(".select2-results").css("display","none")})}async function r(){try{const n=await(await fetch(s+"get_nakala_images/")).json();$('input[id^="events-"][id$="-image_url"]').each(function(){var t=$(this);t.select2({data:n,placeholder:"Choisir une image",formatSelection:t=>t.text.split(";")[1],formatResult:t=>t.children?t.text:t.text.split(";")[1]});{const r=t.attr("id"),e=r+"-clear",a="openPreview-"+r;$("#"+e).length||(t.after(`
            <br><button type="button" id="${e}" class="btn btn-danger btn-sm" style="margin-right: 10px !important;">Effacer l'image</button>
            <button type="button" id="${a}" class="btn btn-primary btn-sm">Aper√ßu de l'image</button>
        `),t.val()||($("#"+e).hide(),$("#"+a).hide()),t.on("change",function(){$(this).val()?($("#"+e).show(),$("#"+a).show()):($("#"+e).hide(),$("#"+a).hide())}),$("#"+e).on("click",function(){$("#"+r).val(null).trigger("change")}),$("#"+a).on("click",async function(){var t,e=$("#"+r).val();if(e){var[e,,a]=e.split(";");try{var n=await(await fetch(s+"get_nakala_data_identifiers/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({register_identifier:e})})).json(),i=`${o}embed/${n.nakala_identifier}/`+a;t=i,$("#imagePreview").attr({src:t}),$("#iframeContainer").attr("style","display: flex"),$("#closePreview").on("click",function(){$("#iframeContainer").attr("style","display: none")})}catch(t){console.error(t)}}}))}})}catch(t){console.error(t)}}i(t),i(e),""!==a&&(n(t,"forename",a),n(e,"surname",a)),$("#events-button").on("click",r),r()});const KB_URL_MAP={Wikidata:"www.wikidata.org/entity/<ID>",Biblissima:"data.biblissima.fr/w/Item:<ID>",VIAF:"www.viaf.org/viaf/<ID>/",DataBnF:"data.bnf.fr/fr/<ID>/","Studium Parisiense":"studium-parisiense.univ-paris1.fr/individus/<ID>",Collecta:"www.collecta.fr/p/COL-IMG-<ID>"};function fetchCorrectUrlStringFromKbSelect(t){var e=t.id.split("-")[1],t=$(t).select2("val");$(`#kb_links-${e}-url`).val(KB_URL_MAP[t])}