$(document).ready(function(){const BASE_URL="/endp-person/endp-person/admin/person/";const API_NAKALA_API="https://api.nakala.fr/";let selectForename=$(".input-select-tag-form-1");let selectSurname=$(".input-select-tag-form-2");let pref_label=$("#pref_label").val();function fetchLabels(selectElement,typeLabel,prefLabel){$.ajax({url:`${BASE_URL}get_persons_alt_labels/`,type:"POST",data:{type_label:typeLabel,person_pref_label:prefLabel},success:function(data){selectElement.val(data).trigger("change")},error:function(data){console.log(data)}})}function configureSelect2(selectElement){selectElement.select2({tags:[""],tokenSeparators:[";"],separator:";"}).on("select2-open",function(){$(".select2-results").css("display","none")})}configureSelect2(selectForename);configureSelect2(selectSurname);if(pref_label!==""){fetchLabels(selectForename,"forename",pref_label);fetchLabels(selectSurname,"surname",pref_label)}function openPreview(url){const iframe=$("#imagePreview");iframe.attr({src:url});$("#iframeContainer").attr("style","display: flex");$("#closePreview").on("click",function(){$("#iframeContainer").attr("style","display: none")})}async function addSelect2Image(){try{const response=await fetch(`${BASE_URL}get_nakala_images/`);const data=await response.json();$('input[id^="events-"][id$="-image_url"]').each(function(){const select=$(this);select.select2({data:data,placeholder:"Choisir une image",formatSelection:selectData=>selectData.text.split(";")[1],formatResult:selectData=>{return selectData.children?selectData.text:selectData.text.split(";")[1]}});createButtons(select)})}catch(error){console.error(error)}}function createButtons(selectElement){const idEventSelectClear=selectElement.attr("id");const idEventSelectClearBtn=`${idEventSelectClear}-clear`;const idEventSelectPreviewBtn=`openPreview-${idEventSelectClear}`;if(!$(`#${idEventSelectClearBtn}`).length){selectElement.after(`
            <button type="button" id="${idEventSelectClearBtn}" class="btn btn-danger btn-sm" style="margin-right: 10px !important; margin-top: 5px !important;">Effacer l'image</button>
            <button type="button" id="${idEventSelectPreviewBtn}" class="btn btn-primary btn-sm" style=" margin-top: 5px !important;">Aper√ßu de l'image</button>
        `);if(!selectElement.val()){$(`#${idEventSelectClearBtn}`).hide();$(`#${idEventSelectPreviewBtn}`).hide()}selectElement.on("change",function(){if($(this).val()){$(`#${idEventSelectClearBtn}`).show();$(`#${idEventSelectPreviewBtn}`).show()}else{$(`#${idEventSelectClearBtn}`).hide();$(`#${idEventSelectPreviewBtn}`).hide()}});$(`#${idEventSelectClearBtn}`).on("click",function(){$(`#${idEventSelectClear}`).val(null).trigger("change")});$(`#${idEventSelectPreviewBtn}`).on("click",async function(){const selectedValue=$(`#${idEventSelectClear}`).val();if(selectedValue){const[register_identifier,,image_sha1]=selectedValue.split(";");try{const response=await fetch(`${BASE_URL}get_nakala_data_identifiers/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({register_identifier:register_identifier})});const data=await response.json();const url=`${API_NAKALA_API}embed/${data.nakala_identifier}/${image_sha1}`;openPreview(url)}catch(error){console.error(error)}}})}}$("#events-button").on("click",addSelect2Image);addSelect2Image()});const KB_URL_MAP={Wikidata:"www.wikidata.org/entity/<ID>",Biblissima:"data.biblissima.fr/w/Item:<ID>",VIAF:"www.viaf.org/viaf/<ID>/",DataBnF:"data.bnf.fr/fr/<ID>/","Studium Parisiense":"studium-parisiense.univ-paris1.fr/individus/<ID>",Collecta:"www.collecta.fr/p/COL-IMG-<ID>"};function fetchCorrectUrlStringFromKbSelect(event){let UserKbSelected=event.id;let number=UserKbSelected.split("-")[1];let KbType=$(event).select2("val");let formattedString=`#kb_links-${number}-url`;$(formattedString).val(KB_URL_MAP[KbType])}