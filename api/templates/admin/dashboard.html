{% extends 'admin/master.html' %}

{% block body %}
<div class="container">
  <h1>Tableau de bord</h1>
  <div id="container"></div>
</div>


{% block script %}
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script type="text/javascript">
  const data_url = "{{ url_for('dashboardview.data_for_chart') }}"
  fetch(data_url, {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json'
    },
})
    .then(function(response) {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('Erreur lors de la requête pour récupérer les données.');
        }
    })
    .then(function(data) {
        // Créez l'objet data avec les résultats de la requête
        var dataset = [
            { label: "Persons", count: data.persons },
            { label: "Places", count: data.places },
            { label: "Places Terms", count: data.places_terms }
        ];
        console.log(dataset)

        var margin = {top: 20, right: 20, bottom: 30, left: 40};
        var width = 500 - margin.left - margin.right;
        var height = 300 - margin.top - margin.bottom;

        var xScale = d3.scaleBand()
    .range([0, width])
    .padding(0.1)
    .domain(dataset.map(function(d) { return d.label; }));

        var yScale = d3.scaleLinear()
    .range([height, 0])
    .domain([0, d3.max(dataset, function(d) { return d.count; })]);

        var yAxis = d3.axisLeft(yScale);

        var svg = d3.create("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg.selectAll("rect")
    .data(dataset)
    .enter().append("rect")
    .attr("x", function(d) { return xScale(d.label); })
    .attr("y", function(d) { return yScale(d.count); })
    .attr("width", xScale.bandwidth())
    .attr("height", function(d) { return height - yScale(d.count); })
    .attr("fill", "steelblue");
  container.append(svg.node())
    })


    .catch(function(error) {
        console.error("Erreur lors de la requête pour récupérer les données:", error);
    });
</script>
{% endblock script %}

{% endblock body %}
